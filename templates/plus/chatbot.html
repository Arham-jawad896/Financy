<!-- templates/chatbot.html -->
{% extends "dashboard.html" %}
{% block page_content %}
<h2>Chatbot</h2>

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<ul class="flashes">
    {% for category, message in messages %}
    {% if category == 'success' or category == 'danger' %}
    <li class="{{ category }}">{{ message }}</li>
    {% endif %}
    {% endfor %}
</ul>
{% endif %}
{% endwith %}

<!-- Chatbot UI -->
<div class="chatbot-container">
    <h3>Chat with Us!</h3>
    <div class="chat-box">
        <div class="messages" id="chat-display">
            <!-- Messages will appear here -->
        </div>
        <input type="text" id="user-input" placeholder="Type your message..." required>
        <button id="send-button">Send</button>
    </div>
</div>

<style>
    body {
        margin: 0;
        overflow-x: hidden;
        font-family: 'Roboto', sans-serif;
        background-color: #0B0C10;
        color: white;
    }

    h2 {
        text-align: center;
        margin-bottom: 20px;
        animation: fadeIn 1s ease-in-out;
    }

    h3 {
        margin-top: 20px;
        animation: fadeIn 1s ease-in-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .chatbot-container {
        display: flex;
        flex-direction: column;
        margin: 0 auto 20px auto;
        background-color: #2C3034;
        padding: 20px;
        border-radius: 8px;
        width: 90%;
        max-width: 800px; /* Increased width */
        height: 80vh; /* Set height for better visibility */
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        animation: slideIn 0.5s ease-in-out;
        position: relative;
        overflow: hidden; /* Prevent overflow */
    }

    @keyframes slideIn {
        from {
            transform: translateY(-30px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .chat-box {
        display: flex;
        flex-direction: column;
        margin-top: 10px;
        height: 100%; /* Fill the container */
    }

    .messages {
        background-color: #1F2833;
        border-radius: 5px;
        padding: 10px;
        flex-grow: 1; /* Allow the message box to grow */
        overflow-y: auto;
        margin-bottom: 10px;
    }

    input[type="text"] {
        padding: 10px;
        margin: 5px 0;
        border: none;
        border-radius: 5px;
        background-color: #2C3034;
        color: white;
        width: calc(100% - 22px);
        transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
    }

    input[type="text"]:focus {
        outline: none;
        background-color: #3A3D40;
        transform: scale(1.02);
        box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
    }

    button {
        background-color: #45A29E;
        color: white;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        margin-top: 10px;
    }

    button:hover {
        background-color: #66FCF1;
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(102, 252, 241, 0.6);
    }

    .flashes {
        list-style-type: none;
        padding: 0;
        margin: 20px 0;
    }

    .flashes li {
        margin: 10px 0;
        padding: 10px;
        border-radius: 5px;
    }

    .success {
        background-color: #d4edda;
        color: #155724;
    }

    .danger {
        background-color: #f8d7da;
        color: #721c24;
    }

    /* Ensure sidebar icon size */
    .sidebar-icon {
        width: 24px; /* Adjust size as needed */
        height: 24px; /* Adjust size as needed */
    }
</style>

<script>
    document.getElementById('send-button').addEventListener('click', async function () {
    const userInput = document.getElementById('user-input').value;
    if (!userInput) return; // Ignore empty input

    // Display the user's message
    appendMessage('You: ' + userInput);

    // Clear the input field
    document.getElementById('user-input').value = '';

    try {
        const response = await fetch('/chatbot', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ message: userInput })
        });
        const data = await response.json();

        // Display the bot's response
        appendMessage('Chatbot: ' + data.response);

    } catch (error) {
        console.error('Error:', error);
        appendMessage('Chatbot: Sorry, there was an error. Please try again.');
    }
});

function appendMessage(message) {
    const messagesContainer = document.querySelector('.messages');
    const messageElement = document.createElement('div');
    messageElement.textContent = message;
    messagesContainer.appendChild(messageElement);
    messagesContainer.scrollTop = messagesContainer.scrollHeight; // Auto-scroll to the bottom
}

</script>
{% endblock %}
